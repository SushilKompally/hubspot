version: 2

models:
  - name: fact_lead_history
    description: >
      History fact table capturing attributeâ€‘level changes for HubSpot leads.
      Tracks old/new values, change type, who changed the record, and SCD status flags.
    config:
      contract:
        enforced: true

    columns:
      - name: hs_history_id
        description: Unique identifier of the lead history record from HubSpot.
        data_type: number
        tests:
          - not_null
          - unique

      - name: lead_key
        description: Foreign key to fact_lead.hs_lead_id.
        data_type: number
        # tests:
          # - relationships:
          #     to: ref('fact_lead')
          #     field: hs_lead_id

      - name: status
        description: Updated status at this point in history.
        data_type: string

      - name: source
        description: Updated source value at this point in history.
        data_type: string

      - name: old_value
        description: Value before the change occurred.
        data_type: string

      - name: new_value
        description: Value after the change occurred.
        data_type: string

      - name: changed_by_key
        description: Foreign key referencing dim_owner.owner_key who made the change.
        data_type: number
        # tests:
          # - relationships:
          #     to: ref('dim_owner')
          #     field: owner_key

      - name: change_type
        description: Type of update (e.g., UPDATE, INSERT).
        data_type: string

      - name: change_date
        description: Timestamp of when the change was recorded in HubSpot.
        data_type: timestamp_ntz
        tests:
          - not_null

      - name: created_date
        description: Timestamp when the history entry was created.
        data_type: timestamp_ntz

      - name: is_current
        description: Flag indicating whether this is the current active version.
        data_type: boolean

      - name: is_deleted
        description: Flag indicating whether the history record is marked deleted.
        data_type: boolean

      - name: valid_from
        description: Load timestamp when this record entered the gold layer.
        data_type: timestamp_ntz

      - name: last_modified_date
        description: Used for incremental MERGE filtering.
        data_type: timestamp_ntz